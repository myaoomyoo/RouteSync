<% layout('layouts/dashboard') -%>
<% block('title', 'Driver Dashboard') -%>

<h2 class="text-2xl font-semibold text-gray-800 mb-6">Your Dashboard</h2>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Trip History Chart -->
    <div class="bg-card p-6 rounded-lg shadow">
        <h3 class="text-lg font-medium text-card-foreground mb-4">Weekly Trip History</h3>
        <canvas id="tripHistoryChart"></canvas>
    </div>

    <!-- Status Summary -->
    <div class="bg-card p-6 rounded-lg shadow">
        <h3 class="text-lg font-medium text-card-foreground mb-4">Trip Status Summary</h3>
        <canvas id="statusSummaryChart"></canvas>
    </div>

    <!-- Vehicle Information -->
    <div class="bg-card p-6 rounded-lg shadow col-span-1 md:col-span-2 lg:col-span-3">
        <h3 class="text-lg font-medium text-card-foreground mb-4">Your Information</h3>
        <dl class="grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2">
            <div class="sm:col-span-1">
                <dt class="text-sm font-medium text-muted-foreground">Phone</dt>
                <dd class="mt-1 text-sm text-foreground"><%= user.phone %></dd>
            </div>
            <div class="sm:col-span-1">
                <dt class="text-sm font-medium text-muted-foreground">Vehicle</dt>
                <dd class="mt-1 text-sm text-foreground"><%= user.vehicleName %> (<%= user.vehicleType %>)</dd>
            </div>
            <div class="sm:col-span-1">
                <dt class="text-sm font-medium text-muted-foreground">Vehicle Size</dt>
                <dd class="mt-1 text-sm text-foreground"><%= user.vehicleSize %></dd>
            </div>
        </dl>
    </div>
</div>

<script>
    // Fetch and render trip history chart
    fetch('/api/driver/trip-history')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('tripHistoryChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['6 days ago', '5 days ago', '4 days ago', '3 days ago', '2 days ago', 'Yesterday', 'Today'],
                    datasets: [{
                        label: '# of Trips',
                        data: data.data,
                        backgroundColor: 'hsl(var(--primary))',
                        borderColor: 'hsl(var(--primary))',
                        borderWidth: 1
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });
        });

    // Fetch and render status summary chart
    fetch('/api/driver/status-summary')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('statusSummaryChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Delayed', 'Cancelled'],
                    datasets: [{
                        data: [data.completed, data.delayed, data.cancelled],
                        backgroundColor: ['hsl(var(--primary))', 'hsl(var(--secondary))', 'hsl(var(--destructive))'],
                    }]
                }
            });
        });
</script>