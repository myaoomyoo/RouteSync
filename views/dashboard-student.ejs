<% layout('layouts/dashboard') -%>
<% block('title', 'Student Dashboard') -%>

<h2 class="text-2xl font-semibold text-gray-800 mb-6">Your Dashboard</h2>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Travel History Chart -->
    <div class="bg-card p-6 rounded-lg shadow">
        <h3 class="text-lg font-medium text-card-foreground mb-4">Weekly Travel History</h3>
        <canvas id="travelHistoryChart"></canvas>
    </div>

    <!-- Attendance Summary -->
    <div class="bg-card p-6 rounded-lg shadow">
        <h3 class="text-lg font-medium text-card-foreground mb-4">Attendance Summary</h3>
        <canvas id="attendanceChart"></canvas>
    </div>

    <!-- Profile Information -->
    <div class="bg-card p-6 rounded-lg shadow col-span-1 md:col-span-2 lg:col-span-3">
        <h3 class="text-lg font-medium text-card-foreground mb-4">Your Information</h3>
        <dl class="grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2">
            <div class="sm:col-span-1">
                <dt class="text-sm font-medium text-muted-foreground">Home Address</dt>
                <dd class="mt-1 text-sm text-foreground"><%= user.homeAddress || 'Not set' %></dd>
            </div>
        </dl>
    </div>
</div>

<script>
    // Fetch and render travel history chart
    fetch('/api/student/travel-history')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('travelHistoryChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['6 days ago', '5 days ago', '4 days ago', '3 days ago', '2 days ago', 'Yesterday', 'Today'],
                    datasets: [{
                        label: '# of Trips',
                        data: data.data,
                        backgroundColor: 'hsl(var(--primary))',
                        borderColor: 'hsl(var(--primary))',
                        borderWidth: 1
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });
        });

    // Fetch and render attendance chart
    fetch('/api/student/attendance')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('attendanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Present', 'Late', 'Absent'],
                    datasets: [{
                        data: [data.present, data.late, data.absent],
                        backgroundColor: ['hsl(var(--primary))', 'hsl(var(--secondary))', 'hsl(var(--destructive))'],
                    }]
                }
            });
        });
</script>