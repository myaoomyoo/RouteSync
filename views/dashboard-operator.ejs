<% layout('layouts/dashboard') -%>
<% block('title', 'Operator Dashboard') -%>

<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-semibold text-gray-800">Operator Dashboard</h2>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Daily Trips Chart -->
    <div class="bg-card p-6 rounded-lg shadow">
        <h3 class="text-lg font-medium text-card-foreground mb-4">Daily Trips Overview</h3>
        <canvas id="dailyTripsChart"></canvas>
    </div>

    <!-- Status Summary -->
    <div class="bg-card p-6 rounded-lg shadow">
        <h3 class="text-lg font-medium text-card-foreground mb-4">Overall Status Summary</h3>
        <canvas id="statusSummaryChart"></canvas>
    </div>
</div>

<script>
    // Fetch and render daily trips chart
    fetch('/api/operator/daily-trips')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('dailyTripsChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['6 days ago', '5 days ago', '4 days ago', '3 days ago', '2 days ago', 'Yesterday', 'Today'],
                    datasets: [{
                        label: 'Total Trips',
                        data: data.data,
                        backgroundColor: 'hsla(var(--primary), 0.2)',
                        borderColor: 'hsl(var(--primary))',
                        borderWidth: 1,
                        tension: 0.3
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });
        });

    // Fetch and render status summary chart
    fetch('/api/operator/status-summary')
        .then(response => response.json())
        .then(data => {
            const ctx = document.getElementById('statusSummaryChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Completed', 'Late', 'Absent'],
                    datasets: [{
                        data: [data.completed, data.late, data.absent],
                        backgroundColor: ['hsl(var(--primary))', 'hsl(var(--secondary))', 'hsl(var(--destructive))'],
                    }]
                }
            });
        });
</script>